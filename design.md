# Gobble: Dobbleé¢¨webã‚²ãƒ¼ãƒ 

æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯å‹‰å¼·ã®ãŸã‚å€‹äººã§ä½œæˆã—ãŸã‚‚ã®ã§ã™ã€‚
æ¥½ã—ã‹ã£ãŸã‚‰ãœã²æœ¬å®¶[Dobble](https://hobbyjapan.games/dobble/)ã‚’ãŠè²·ã„ä¸Šã’ãã ã•ã„ã€‚
(ç‰©ç†ã®ã»ã†ãŒé¢ç™½ã„ã‚ˆï¼)

## ğŸ¯ æ¦‚è¦

- gRPCã®å­¦ç¿’ã«é©ã—ãŸã‚·ãƒ³ãƒ—ãƒ«ã§å®Ÿç”¨çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ç™º
- Dobbleã®ãƒ«ãƒ¼ãƒ«ã‚’æ´»ã‹ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ãƒ»ãƒãƒƒãƒãƒ³ã‚°ãƒ»çŠ¶æ…‹åŒæœŸã‚’gRPCã§å®Ÿè£…
- ã‚µãƒ¼ãƒãƒ¼ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹

---

## ğŸ§© Dobble ã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«ï¼ˆãŠã•ã‚‰ã„ï¼‰

- å„ã‚«ãƒ¼ãƒ‰ã«è¤‡æ•°ã®ã‚·ãƒ³ãƒœãƒ«ãŒã‚ã‚‹
- ä»»æ„ã®2æšã®ã‚«ãƒ¼ãƒ‰ã«ã¯**å¿…ãš1ã¤ã ã‘å…±é€šã™ã‚‹ã‚·ãƒ³ãƒœãƒ«**ãŒã‚ã‚‹
- å…±é€šã‚·ãƒ³ãƒœãƒ«ã‚’è¦‹ã¤ã‘ã¦ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ˆã‚Šå…ˆã«å«ã¶ã‚²ãƒ¼ãƒ 

---

## ğŸ— ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

![](./design.drawio.png)

âœ… æ§‹æˆã®ãƒã‚¤ãƒ³ãƒˆæ•´ç†

ğŸ”· 1. gRPCã‚µãƒ¼ãƒãƒ¼
- çŠ¶æ…‹ç®¡ç†ï¼ˆã‚²ãƒ¼ãƒ ã®ä½œæˆãƒ»å‚åŠ ãƒ»ãƒãƒƒãƒå‡¦ç†ãªã©ï¼‰ã‚’æ‹…å½“
- Remix ã¾ãŸã¯ Connect çµŒç”±ã§å‘¼ã³å‡ºã•ã‚Œã‚‹
- WebSocketé€šçŸ¥ã®ãƒˆãƒªã‚¬ãƒ¼ã‚‚ã“ã“ã‹ã‚‰é€ã‚‹

ğŸ”¶ 2. coder/websocket
- WebSocketé€šçŸ¥å°‚ç”¨ã®è»½é‡ã‚µãƒ¼ãƒãƒ¼
- gRPCã‹ã‚‰ã€ŒçŠ¶æ…‹å¤‰åŒ–ã‚¤ãƒ™ãƒ³ãƒˆã€ã‚’å—ã‘å–ã‚Š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ pushï¼ˆå‹æ•—ãƒ»ã‚¹ã‚³ã‚¢ãƒ»ã‚«ãƒ¼ãƒ‰æ›´æ–°ãªã©ï¼‰

ğŸŒ€ 3. Remix + Connect
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactãƒ™ãƒ¼ã‚¹ï¼‰
- Connectï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã‚’ä½¿ã£ã¦ gRPCã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡
- WebSocketã‚‚ç›´æ¥æ¥ç¶šã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡

ğŸ§ 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼
- ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ Remix ã‚’é€šã˜ã¦å‚åŠ 
- Connectï¼ˆgRPC-JSONï¼‰ã§çŠ¶æ…‹å–å¾—ãƒ»æ“ä½œ
- WebSocketã§é€šçŸ¥ã‚’å—ä¿¡
---

## ğŸ§ª gRPC ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ï¼ˆæ¦‚è¦ï¼‰

### GobbleService

```protobuf
service GobbleService {
  rpc JoinGame(JoinRequest) returns (JoinResponse);
  rpc GetGameState(GameStateRequest) returns (GameStateResponse);
  rpc StreamGameState(GameStreamRequest) returns (stream GameStateUpdate);
  rpc MatchSymbol(MatchRequest) returns (MatchResponse);
  rpc LeaveGame(LeaveRequest) returns (LeaveResponse);
}
```

---

## ğŸ“¦ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®šç¾©ï¼ˆä¾‹ï¼‰

```protobuf
message JoinRequest {
  string player_name = 1;
}

message JoinResponse {
  string player_id = 1;
  string game_id = 2;
}

message GameStateRequest {
  string game_id = 1;
}

message GameStateResponse {
  repeated Card cards = 1;
  string current_turn_player = 2;
}

message MatchRequest {
  string player_id = 1;
  string game_id = 2;
  string symbol = 3;
}

message MatchResponse {
  bool correct = 1;
  string message = 2;
}

message Card {
  string card_id = 1;
  repeated string symbols = 2;
}
```

---

## âš™ï¸ æ©Ÿèƒ½ä¸€è¦§

| æ©Ÿèƒ½å         | å†…å®¹                                                        |
|----------------|-------------------------------------------------------------|
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ² | åå‰ã‚’ç™»éŒ²ã—ã¦ã‚²ãƒ¼ãƒ ã«å‚åŠ                                   |
| ã‚²ãƒ¼ãƒ é–‹å§‹     | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ2äººä»¥ä¸Šã«ãªã‚‹ã¨é–‹å§‹                             |
| ã‚«ãƒ¼ãƒ‰é…å¸ƒ     | å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å ´ã«ã‚«ãƒ¼ãƒ‰ã‚’é…å¸ƒï¼ˆå…±é€šã‚·ãƒ³ãƒœãƒ«ã‚’æŒãŸã›ã‚‹ï¼‰   |
| ã‚·ãƒ³ãƒœãƒ«é¸æŠ   | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå…±é€šã ã¨æ€ã†ã‚·ãƒ³ãƒœãƒ«ã‚’é¸ã‚“ã§é€ä¿¡               |
| åˆ¤å®š           | ã‚µãƒ¼ãƒãƒ¼ãŒæ­£èª¤ã‚’åˆ¤å®šã€æˆåŠŸã—ãŸã‚‰ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°               |
| çŠ¶æ…‹é…ä¿¡       | ã‚µãƒ¼ãƒãƒ¼ãŒã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«çŠ¶æ…‹ã‚’é…ä¿¡ï¼ˆstreamï¼‰       |
| ã‚²ãƒ¼ãƒ çµ‚äº†     | ã‚«ãƒ¼ãƒ‰ãŒå°½ããŸæ™‚ç‚¹ã§çµ‚äº†ã€çµæœã‚’é…ä¿¡                        |

---

## ğŸ§  å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

- Unary RPC vs. Streaming RPC
- gRPCã«ã‚ˆã‚‹åŒæ–¹å‘é€šä¿¡
- çŠ¶æ…‹ç®¡ç†ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­è¨ˆ
- gRPCurl ã‚„ CLIãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆ
- .protoãƒ•ã‚¡ã‚¤ãƒ«è¨­è¨ˆã¨IDLãƒ™ãƒ¼ã‚¹ã®é–‹ç™ºãƒ•ãƒ­ãƒ¼

---

## ğŸ“ˆ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—æ¡ˆ

1. `JoinGame` ã¨ `GetGameState` ã‚’ä½œã£ã¦æ¥ç¶šãƒ†ã‚¹ãƒˆ
2. ã‚«ãƒ¼ãƒ‰ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ•°å­¦çš„ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªDobbleã‚«ãƒ¼ãƒ‰ï¼‰
3. `MatchSymbol` â†’ åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
4. streamã§çŠ¶æ…‹ã‚’é…ä¿¡
5. ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ or gRPCurlã§æ¤œè¨¼
6. UIè¿½åŠ ï¼ˆå¿…è¦ãªã‚‰ï¼‰

---

## ğŸ“ è£œè¶³

- ã€ŒGobbleã€ã¯ã€ŒgRPC + Dobbleã€ã«æ•¬æ„ã‚’è¡¨ã—ãŸåå‰

---


## âœ… TODOãƒªã‚¹ãƒˆ


### ğŸš€ åˆæœŸå‹•ä½œç¢ºèªã‚¹ãƒ†ãƒƒãƒ—

- [ ] Goã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨å¥¨: Go 1.21ä»¥é™ï¼‰
- [ ] Node.js & npm/yarnã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨å¥¨: Node 18+ï¼‰
- [ ] `protoc` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« + ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆ`protoc-gen-go`, `protoc-gen-connect-go`, `protoc-gen-connect-web`ï¼‰
- [ ] `buf` CLI ã®å°å…¥ã¨åˆæœŸåŒ–ï¼ˆ`buf.yaml`, `buf.gen.yaml` ã®ä½œæˆï¼‰
- [ ] `.proto` ãƒ•ã‚¡ã‚¤ãƒ«ã« `Hello` ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®šç¾©ï¼ˆ`HelloRequest`, `HelloResponse`ï¼‰
- [ ] Goã§ `Hello` ã‚’è¿”ã™æœ€å°ã® Connect gRPCã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè£…
- [ ] Goã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•ï¼ˆä¾‹ï¼š`:8080`ï¼‰
- [ ] `buf generate` ã§ TypeScript ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
- [ ] Remix ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ `Connect` ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¨­å®š
- [ ] Remix ã® Loader ã§ `hello()` ã‚’å‘¼ã³ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§æ–‡å­—åˆ—ã‚’è¡¨ç¤º

### ğŸ® ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ï¼ˆgRPCï¼‰

- [ ] `JoinGame` å®Ÿè£…ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‚åŠ ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- [ ] `GetGameState` å®Ÿè£…ï¼šç¾åœ¨ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’å–å¾—
- [ ] `MatchSymbol` å®Ÿè£…ï¼šã‚·ãƒ³ãƒœãƒ«ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹åˆ¤å®š
- [ ] `StreamGameState` å®Ÿè£…ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«çŠ¶æ…‹ã‚’é…ä¿¡ï¼ˆstreamï¼‰
- [ ] `LeaveGame` å®Ÿè£…ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é›¢è„±å‡¦ç†
- [ ] `GameManager` è¨­è¨ˆï¼šã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ä¿æŒã¨ç®¡ç†

### ğŸ§© ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯

- [ ] Dobbleã‚«ãƒ¼ãƒ‰ã®çµ„ã¿åˆã‚ã›ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
- [ ] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å ´ã¸ã®ã‚«ãƒ¼ãƒ‰é…å¸ƒå‡¦ç†
- [ ] ã‚¹ã‚³ã‚¢ç®¡ç†ã¨ã‚²ãƒ¼ãƒ çµ‚äº†åˆ¤å®šã®å®Ÿè£…

### ğŸŒ€ é€šä¿¡å‡¦ç†

- [ ] gRPC ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ•´ç†
- [ ] WebSocketã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ï¼ˆ`nhooyr/websocket` æ¨å¥¨ï¼‰
- [ ] gRPCâ†’WebSocketã¸ã®ã‚¤ãƒ™ãƒ³ãƒˆé€£æºå‡¦ç†
- [ ] WebSocketæ¥ç¶šã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è­˜åˆ¥ãƒ»ãƒ«ãƒ¼ãƒ åˆ†é›¢å‡¦ç†

### ğŸ–¥ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆRemixï¼‰

- [ ] Connectã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè£…ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šãƒ»è³¼èª­å‡¦ç†
- [ ] UIã§ã®çŠ¶æ…‹è¡¨ç¤ºï¼ˆã‚«ãƒ¼ãƒ‰ãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åãªã©ï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«å¯¾å¿œã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œï¼ˆJoin/Matchï¼‰

### ğŸ§ª é–‹ç™ºè£œåŠ©

- [ ] gRPCurl ã¾ãŸã¯ grpcui ã§ã®æ‰‹å‹•ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆç”¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- [ ] .protoãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ã¨æ›´æ–°ç®¡ç†

### ğŸ“˜ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ”¹å–„

- [ ] Connectã¨gRPCã®é–¢ä¿‚ã‚’æ§‹æˆå›³ã«æ˜ç¤ºï¼ˆçŸ¢å°ã®æ–¹å‘ãªã©ï¼‰
- [ ] WebSocketé€šçŸ¥ã®æµã‚Œãƒ»å¥‘æ©Ÿã‚’è¿½è¨˜
- [ ] æ§‹æˆå…¨ä½“ã‚’ç°¡æ½”ã«è§£èª¬ã—ãŸå›³ã®è¿½åŠ 

# ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
```mermaid
sequenceDiagram
    participant c1 as client1
    participant c2 as client2
    participant s as server
    participant d as database

    %% ã‚²ãƒ¼ãƒ ä½œæˆ
    note over c1,d: ã‚²ãƒ¼ãƒ ä½œæˆ
    c1 ->> c1: ã‚²ãƒ¼ãƒ ä½œæˆ
    activate c1
    c1 ->>+ s: ã‚²ãƒ¼ãƒ ä½œæˆ
    s ->> d: ã‚²ãƒ¼ãƒ ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
    s ->> d: ãƒ¦ãƒ¼ã‚¶ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ(GameId, status=Joining)
    s ->>- c1: ä½œæˆçµæœ(ã‚²ãƒ¼ãƒ IDã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID)
    c1 ->>+ s: websocketæ¥ç¶šç¢ºç«‹(ã‚²ãƒ¼ãƒ IDã€)
    s ->>- s: websocketã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«(ã‚²ãƒ¼ãƒ ID)
    deactivate c1

    alt websocketæ¥ç¶šãŒåˆ‡ã‚ŒãŸ
        s ->> d: ã‚²ãƒ¼ãƒ ã‚’ENDçŠ¶æ…‹ã«ã™ã‚‹(ã‚²ãƒ¼ãƒ ID)
    end

    %% ã‚²ãƒ¼ãƒ å‚åŠ 
    note over c1,d: ã‚²ãƒ¼ãƒ å‚åŠ 
    c2 ->>+ s: ã‚²ãƒ¼ãƒ æƒ…å ±å–å¾—
    s ->>- c2: ã‚²ãƒ¼ãƒ æƒ…å ±
    c2 ->> c2: ã‚²ãƒ¼ãƒ å‚åŠ (ã‚²ãƒ¼ãƒ ID)
    activate c2
    c2 ->>+ s: ã‚²ãƒ¼ãƒ å‚åŠ (ã‚²ãƒ¼ãƒ ID)
    s ->> d: ãƒ¦ãƒ¼ã‚¶ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ(GameId, status=Joining)
    s ->>- c2: å‚åŠ çµæœ(ã‚²ãƒ¼ãƒ ID, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID)
    c2 ->>+ s: websocketæ¥ç¶šç¢ºç«‹(ã‚²ãƒ¼ãƒ ID, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID)
    deactivate c2
    s ->>- s: websocketã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«

    alt 2äººä»¥ä¸Šå‚åŠ ã—ã¦ã„ã‚‹ (ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ãƒ«ãƒ¼ãƒãƒ³)
        s ->> d: ã‚²ãƒ¼ãƒ ã‚’READYçŠ¶æ…‹ã«ã™ã‚‹(ã‚²ãƒ¼ãƒ ID)
        s ->> c2: ã‚²ãƒ¼ãƒ READYã‚’é€šçŸ¥(ws)
        s ->> c1: ã‚²ãƒ¼ãƒ READYã‚’é€šçŸ¥(ws)
    end

    %% ã‚²ãƒ¼ãƒ é–‹å§‹
    note over c1,d: ã‚²ãƒ¼ãƒ é–‹å§‹

    c1 ->>+ s: ã‚²ãƒ¼ãƒ é–‹å§‹(ã‚²ãƒ¼ãƒ ID, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID)
    s ->>- d: ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹æ›´æ–°(to Starting)

    c2 ->>+ s: ã‚²ãƒ¼ãƒ é–‹å§‹(ã‚²ãƒ¼ãƒ ID)
    s ->>- d: ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹æ›´æ–°(to Starting)

    alt å…¨å“¡é–‹å§‹ã—ãŸ (ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ãƒ«ãƒ¼ãƒãƒ³)
        s ->> d: ã‚²ãƒ¼ãƒ ã‚’STARTçŠ¶æ…‹ã«ã™ã‚‹(ã‚²ãƒ¼ãƒ ID)
        s ->> c2: ã‚²ãƒ¼ãƒ STARTã‚’é€šçŸ¥(ws)
        s ->> c1: ã‚²ãƒ¼ãƒ STARTã‚’é€šçŸ¥(ws)
    end

    %% ã‚²ãƒ¼ãƒ é€²è¡Œ
    note over c1,d: ã‚«ãƒ¼ãƒ‰ãŒçµ‚ã‚ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
    loop å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰
        c1 ->>+ s: ã‚«ãƒ¼ãƒ‰è¦æ±‚
        s ->>- d: ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹æ›´æ–°(to Requesting)
        c2 ->>+ s: ã‚«ãƒ¼ãƒ‰è¦æ±‚
        s ->>- d: ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹æ›´æ–°(to Requesting)

        alt å…¨ãƒ¦ãƒ¼ã‚¶ã®è¦æ±‚ã‚ã‚Š (ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ãƒ«ãƒ¼ãƒãƒ³)
            s ->> d: ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹æ›´æ–°(to Playing)
            s ->> c2: ã‚«ãƒ¼ãƒ‰é€šçŸ¥(ã‚«ãƒ¼ãƒ‰IDã€prevã‚«ãƒ¼ãƒ‰ID)
            s ->> d: ãƒ¦ãƒ¼ã‚¶çŠ¶æ…‹æ›´æ–°(to Playing)
            s ->> c1: ã‚«ãƒ¼ãƒ‰é€šçŸ¥(ã‚«ãƒ¼ãƒ‰IDã€prevã‚«ãƒ¼ãƒ‰ID)
        end

        c1 ->>+ s: å›ç­”(ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID, ã‚¢ã‚¤ãƒ†ãƒ ID, ã‚«ãƒ¼ãƒ‰ID, prevã‚«ãƒ¼ãƒ‰ID)
        note right of s: ä¾‹ã¨ã—ã¦c1ãŒç­”ãˆãŸå ´åˆã‚’å›³ç¤º<br>é…ã‹ã£ãŸæ–¹ã¯ã‚¹ã‚³ã‚¢å¢—æ¸›ã—ãªã„

        alt ã‚ã£ã¦ã„ã‚‹å ´åˆ
            s ->> d: ã‚¹ã‚³ã‚¢ãƒ—ãƒ©ã‚¹(ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID)
        else é–“é•ã£ã¦ã„ã‚‹å ´åˆ
            s ->> d: ã‚¹ã‚³ã‚¢ãƒã‚¤ãƒŠã‚¹(ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID)
        end
        s ->> c2: ã‚¹ã‚³ã‚¢é€šçŸ¥(broadcast)
        s ->>- c1: ã‚¹ã‚³ã‚¢é€šçŸ¥(broadcast)
    end

    s ->> d: ã‚²ãƒ¼ãƒ ã‚’ENDçŠ¶æ…‹ã«ã™ã‚‹(ã‚²ãƒ¼ãƒ ID)

    s ->> c2: æœ€çµ‚ã‚¹ã‚³ã‚¢é€šçŸ¥(broadcast)
    s ->> c1: æœ€çµ‚ã‚¹ã‚³ã‚¢é€šçŸ¥(broadcast)
```

ãƒ¦ãƒ¼ã‚¶ã®çŠ¶æ…‹
- Joining
- Starting
- Requesting
- Playing

ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹
- CREATED
- READY
- STARTED
- FINISHED
- ABORTED

### ğŸ¨ ERå›³ï¼ˆæ¦‚ç•¥ï¼‰
GAMEã‚’å®Ÿæ–½ã™ã‚‹æ™‚ã«CARDã‚»ãƒƒãƒˆã‚’å–å¾—ã€‚ãƒ©ãƒ³ãƒ€ãƒ ã«CARDã‚’æ¶ˆè²»ã—ãªãŒã‚‰å…¨ã¦ã®CARDã«å¯¾ã—ã¦å‡¦ç†ã‚’ã™ã‚‹ã€‚

```mermaid
erDiagram
    GAME {
        string id
        string status
    }
    PLAYER {
        string id
        string name
        string game_id
        string status
    }
    CARD {
        string id
    }
    ITEM {
        string id
        string symbol
        string card_id
    }

    PLAYER }|--|| GAME : joins
    CARD }|--|{ ITEM : has
```
